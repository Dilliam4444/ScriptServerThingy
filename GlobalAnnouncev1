-- BroadcastWhileLoop.lua (ServerScriptService)

local Players = game:GetService("Players")

local MESSAGE = "IM HACKING REPORT ME!"
local DURATION = 10    -- total seconds to loop
local INTERVAL = 0.1   -- wait interval

-- helper: show a GUI message for a player
local function showMessage(player, text)
    local gui = player:FindFirstChild("PlayerGui"):FindFirstChild("BroadcastGui")
    if not gui then
        gui = Instance.new("ScreenGui")
        gui.Name = "BroadcastGui"
        gui.ResetOnSpawn = false
        gui.Parent = player:WaitForChild("PlayerGui")

        local label = Instance.new("TextLabel")
        label.Name = "MsgLabel"
        label.Size = UDim2.new(0.6, 0, 0.08, 0)
        label.Position = UDim2.new(0.2, 0, 0.05, 0)
        label.BackgroundTransparency = 0.3
        label.TextScaled = true
        label.Font = Enum.Font.SourceSansBold
        label.Text = ""
        label.Visible = false
        label.Parent = gui
    end

    local label = gui:FindFirstChild("MsgLabel")
    if label then
        label.Text = text
        label.Visible = true
    end
end

-- run while loop for all players
task.spawn(function()
    local start = os.clock()
    local count = 0
    while os.clock() - start < DURATION do
        count += 1
        for _, plr in pairs(Players:GetPlayers()) do
            local text = ("[%s]: %s  â€” %d"):format(plr.Name, MESSAGE, count)
            showMessage(plr, text)
        end
        task.wait(INTERVAL)
    end

    -- hide after finished
    for _, plr in pairs(Players:GetPlayers()) do
        local gui = plr:FindFirstChild("PlayerGui"):FindFirstChild("BroadcastGui")
        if gui and gui:FindFirstChild("MsgLabel") then
            gui.MsgLabel.Visible = false
        end
    end
end)

-- also handle new players who join during spam
Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Wait()
    -- if spam is still running, they will get included automatically on next loop iteration
end)
